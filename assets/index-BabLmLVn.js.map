{"version":3,"file":"index-BabLmLVn.js","sources":["../../src/Pages/UserProfileView/index.jsx"],"sourcesContent":["import React, { useEffect, useState, useCallback } from \"react\";\r\nimport { useParams, useLocation, useNavigate } from \"react-router-dom\";\r\nimport ls from \"store2\";\r\nimport { getUserDetails, getUserToken } from \"@/api/Users\";\r\nimport { useCountStore } from \"@/store/index\";\r\nimport Loader from \"@/Components/Loader\";\r\nimport { getToken, setToken } from \"@/utils/auth\";\r\nimport toast from \"react-hot-toast\";\r\nimport CustomErrorToast from \"@/Shared/Tosat/CustomErrorToast\";\r\n\r\nexport default function UserProfileView() {\r\n  const params = useParams();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { setStoreRole, setUser } = useCountStore();\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const param = params.id.split(\"-\");\r\n\r\n  const storeOriginalToken = () => {\r\n    const user = ls.get(\"user\");\r\n    const currentToken = getToken();\r\n    if (!ls.get(\"rootToken\")) {\r\n      ls.set(\"rootToken\", currentToken);\r\n      ls.set(\"rootRole\", user?.role);\r\n    }\r\n  };\r\n\r\n  const switchToNewToken = (newToken) => setToken(newToken);\r\n\r\n  const navigateToRole = (role) => {\r\n    const routes = {\r\n      super_admin: \"/support-agent/dashboard/\",\r\n      supports_agent: \"/supporter/support-agent/dashboard\",\r\n      nurse: \"/supporter/nurse/dashboard\",\r\n      end_user: \"/supporter/end-user/dashboard\",\r\n      elderly: `/supporter/elderlies/elderly-profile/${param[1]}?tab=overview`,\r\n    };\r\n    navigate(routes[role] || \"/support-nurnt/dashboard\");\r\n  };\r\n\r\n  const setUpEverythingForViewProfile = (data) => {\r\n    ls.set(\"user\", data);\r\n    ls.set(\"mainRole\", data.role);\r\n    ls.set(\"role\", data.role);\r\n    setStoreRole({ role: data.role });\r\n    setUser({ role: data.role });\r\n\r\n    setTimeout(() => {\r\n      setLoading(false);\r\n      navigateToRole(data.sub_role || data.role);\r\n    }, 800);\r\n  };\r\n\r\n  const fetchUserProfile = useCallback(async () => {\r\n    try {\r\n      const userDetail = await getUserDetails({ id: param[0] });\r\n\r\n      if (!userDetail?.data?.role) throw new Error(\"Invalid role\");\r\n\r\n      if (param.length >= 2) {\r\n        const tokenRes = await getUserToken({\r\n          id: param[0],\r\n          params: {\r\n            role:\r\n              userDetail.data.role === \"nursing_home\"\r\n                ? \"nurse\"\r\n                : \"supports_agent\",\r\n          },\r\n        });\r\n\r\n        if (tokenRes.data.role == \"end_user\" && tokenRes?.session_code == 0) {\r\n          toast.custom((t) => (\r\n            <CustomErrorToast\r\n              t={t}\r\n              title=\"Error\"\r\n              text={\"This user does not have an active subscription.\"}\r\n            />\r\n          ));\r\n          navigate(-1);\r\n        } else {\r\n          storeOriginalToken();\r\n          switchToNewToken(tokenRes.data.access_token);\r\n          setUpEverythingForViewProfile({\r\n            ...tokenRes.data,\r\n            sub_role: \"elderly\",\r\n          });\r\n        }\r\n      } else {\r\n        const tokenRes = await getUserToken({ id: param[0] });\r\n\r\n        if (tokenRes.data.role == \"end_user\" && tokenRes?.session_code == 0) {\r\n          toast.custom((t) => (\r\n            <CustomErrorToast\r\n              t={t}\r\n              title=\"Error\"\r\n              text={\"Subscription Expired!\"}\r\n            />\r\n          ));\r\n          navigate(-1);\r\n        } else {\r\n          storeOriginalToken();\r\n          switchToNewToken(tokenRes.data.access_token);\r\n          setUpEverythingForViewProfile(userDetail.data);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error fetching user profile:\", err);\r\n      // toast.error(err)\r\n      toast.custom((t) => (\r\n        <CustomErrorToast\r\n          t={t}\r\n          title=\"Error\"\r\n          text={err.response.data.message}\r\n        />\r\n      ));\r\n      navigate(-1);\r\n    }\r\n  }, [params.id]);\r\n\r\n  useEffect(() => {\r\n    fetchUserProfile();\r\n  }, [fetchUserProfile]);\r\n\r\n  if (loading) return <Loader loaderTitle=\"Loading User Profile\" />;\r\n}\r\n"],"names":["UserProfileView","params","useParams","useLocation","navigate","useNavigate","setStoreRole","setUser","useCountStore","loading","setLoading","useState","param","storeOriginalToken","user","ls","currentToken","getToken","switchToNewToken","newToken","setToken","navigateToRole","role","routes","setUpEverythingForViewProfile","data","fetchUserProfile","useCallback","userDetail","getUserDetails","_a","tokenRes","getUserToken","toast","t","jsx","CustomErrorToast","err","useEffect","Loader"],"mappings":"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"}