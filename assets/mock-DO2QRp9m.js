import{h as M,j as e,p as R,E as z,r as s,cc as G,C as V,cd as J,S as W,u as B,aa as F,ab as $,bH as H,aZ as U,ce as Q,cf as P,cg as j,ch as D,ci as K,ag as X,bJ as Z,by as q,bx as ee,G as te,aX as se,cj as le,o as ae}from"./index-BFnxQo33.js";import{C as O}from"./Collapse-Btix8GgS.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},h=new t.Error().stack;h&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[h]="b9ed33df-064d-4ad1-89f3-28605afa40c3",t._sentryDebugIdIdentifier="sentry-dbid-b9ed33df-064d-4ad1-89f3-28605afa40c3")}catch{}function ne({data:t=[],fromDate:h,toDate:c}){const d=((i,r)=>{const l=[];let o=M(i);for(;o.isBefore(r)||o.isSame(r,"day");)l.push(o.format("YYYY-MM-DD")),o=o.add(1,"day");return l})(h,c).map(i=>{const r=t.filter(l=>l.date===i&&l.alarm_group==="Critical").reduce((l,o)=>l+o.count,0);return t.filter(l=>l.date===i&&l.alarm_group==="Warning").reduce((l,o)=>l+o.count,0),t.filter(l=>l.date===i&&l.alarm_group==="Info").reduce((l,o)=>l+o.count,0),{day:M(i).format("ddd"),critical:r}}),f={tooltip:{trigger:"axis"},grid:{left:"0%",right:"0%",bottom:"20%",top:"10%",containLabel:!0},legend:{show:!0,orient:"horizontal",bottom:"10%"},xAxis:{type:"category",data:d.map(i=>i.day)},yAxis:{type:"value"},series:[{name:"Critical",type:"line",data:d.map(i=>i.critical),itemStyle:{color:"#FF0000"},smooth:!0}]};return t.length?e.jsx(z,{option:f,style:{width:"100% !important",height:"100%"}}):e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(R,{description:"No data available for this week"})})}function he(){const[t,h]=s.useState(M().subtract(6,"days").format("YYYY-MM-DD")),[c,m]=s.useState(M().format("YYYY-MM-DD")),[y,d]=s.useState([]),f=s.useCallback(()=>{G({from_date:c,to_date:t}).then(r=>{d(r==null?void 0:r.data)}).catch(r=>{console.log(r)})},[c]);s.useEffect(()=>{f()},[f]);function i(r){r?(h(r.start),m(r.end)):(h(M().subtract(6,"days").format("YYYY-MM-DD")),m(M().format("YYYY-MM-DD")))}return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{id:"ChartHeader",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[22px] font-semibold",children:"Alarms Overview"}),e.jsx("div",{id:"chartController",className:"flex gap-4",children:e.jsx(V,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsx(J,{style:{height:"fit-content"},handleChange:r=>i(r)})})})]}),e.jsx("div",{className:"w-full h-full",children:e.jsx(ne,{data:y,fromDate:t,toDate:c})})]})}function fe({refreshAlertList:t,isElderlyVisible:h=!1,isAlarmViewBtn:c=!1}){const{setModalDataList:m,modalDataList:y}=s.useContext(W),[d,f]=s.useState(!1),[i,r]=s.useState(null),[l,o]=s.useState([]),p=["Critical"],N=B(),{notificationEvent:u}=F(),w=s.useRef(0),v=s.useCallback(async()=>{let a=[],b=30;for(const C of p){if(b<=0)break;const _=H(C);if(_)try{const k=(await $({to_date:"2024-11-30",from_date:M().format("YYYY-MM-DD"),is_resolved:!1,limit:b,..._})).data||[];if(a=[...a,...k],b-=k.length,b<=0)break}catch(A){console.error(`Error fetching ${C} alerts:`,A)}}a.length>w.current&&t(),w.current=a.length,o(a)},[]);s.useEffect(()=>{v()},[v]);const Y={dots:l.length>=2,infinite:l.length>2,speed:500,slidesToShow:l.length===1?1:2,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:a=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:e.jsx("ul",{id:"dots",style:{margin:"0px"},children:a})}),responsive:[{breakpoint:1200,settings:{slidesToShow:(l.length===1,1),slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:1,slidesToScroll:1}}]},S=a=>{window.scrollTo(0,0),N(`/supporter/elderlies/elderly-profile/${a.elderly_id}?tab=overview`)};return s.useEffect(()=>{u&&v()},[u]),e.jsxs(e.Fragment,{children:[l.length>0&&e.jsx("div",{id:"ActiveAlertsCards",className:"w-full mb-2 transition-all duration-300",children:e.jsx(U,{...Y,className:"w-full transition-all duration-300",children:l.map((a,b)=>{var C,_,A,k,I,E;return e.jsx("div",{className:"px-2 overflow-hidden transition-all duration-300 relative w-full",children:e.jsxs("div",{id:"alertItem",className:`rounded-2xl overflow-hidden w-full ${((C=j(a))==null?void 0:C.label)==="Critical"?"bg-red-500":((_=j(a))==null?void 0:_.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} p-4 w-full flex justify-between items-center`,children:[e.jsx("div",{id:"leftSide",className:"z-50",children:e.jsx("div",{id:"alertItemHeader",children:e.jsxs("div",{id:"alertItemTitleAndDescription",className:"flex flex-col gap-6",children:[e.jsxs("div",{id:"time",className:"flex gap-2",children:[h&&e.jsxs("span",{onClick:()=>S(a),className:"bg-white font-semibold p-1 px-2 pl-1 rounded-full text-text-primary flex items-center gap-2 cursor-pointer hover:opacity-90",children:[e.jsx(Q,{size:22,style:{opacity:"0.8"}}),a==null?void 0:a.elderly_name]}),e.jsxs("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary flex items-center gap-2",children:[e.jsx("div",{id:"dot",className:`w-2 h-2 ${((A=j(a))==null?void 0:A.label)==="Critical"?"bg-red-500":((k=j(a))==null?void 0:k.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} rounded-full animate-ping`}),P(a.created_at)]}),e.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary",children:e.jsx(D,{date:a.created_at})})]}),e.jsxs("div",{id:"alertItemTitleAndDescription",children:[e.jsx("h1",{className:"text-xl font-bold text-white m-0",children:(I=j(a))==null?void 0:I.title}),e.jsx("p",{className:"text-white text-base m-0 leading-none",children:(E=j(a))==null?void 0:E.message})]})]})})}),c?e.jsx("div",{id:"btn",className:"z-50 w-fit",children:e.jsx("span",{onClick:()=>{r(a),N("/support-nurnt/dashboard/alarm-detail",{state:{alertData:a,id:a==null?void 0:a.elderly_id}})},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"View Alert"})}):e.jsx("div",{id:"rightSide",className:"z-50 w-fit",children:e.jsx("span",{onClick:()=>{r(a),f(!0)},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"Mark as Complete"})}),e.jsx("img",{src:K,alt:"",className:"absolute top-0 right-0"})]})},b)})})}),e.jsx(X,{openAlertCloseModal:d,setOpenAlertCloseModal:f,selectedAlert:i,getAlertListDatas:()=>{v(),t()}})]})}function re({data:t={}}){var i,r,l,o,p,N,u,w;const h=B(),[c,m]=s.useState(null);s.useRef(null),s.useRef(!1);const[y,d]=s.useState(!1),f=v=>{switch(v){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};return e.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[e.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${f((i=j(t))==null?void 0:i.label)}`,children:[e.jsx("div",{className:"loader"}),e.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[e.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:t.room_name}),e.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(r=j(t))==null?void 0:r.title})]}),e.jsx("span",{onClick:()=>{h(`/supporter/elderlies/elderly-profile/${t==null?void 0:t.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[e.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:t.elderly_name}),e.jsx("p",{className:"text-sm text-gray-500 m-0",children:t.address})]}),e.jsx("div",{})]}),e.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[e.jsx(Z,{deviceId:(l=t==null?void 0:t.rooms)==null?void 0:l.device_no,children:e.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((o=t==null?void 0:t.rooms)==null?void 0:o.mount_type)===1&&((p=t==null?void 0:t.rooms)==null?void 0:p.is_device_bind)&&e.jsx(q,{roomInfo:t==null?void 0:t.rooms}),((N=t==null?void 0:t.rooms)==null?void 0:N.mount_type)===2&&((u=t==null?void 0:t.rooms)==null?void 0:u.is_device_bind)&&e.jsx(ee,{roomInfo:t==null?void 0:t.rooms}),!((w=t==null?void 0:t.rooms)!=null&&w.is_device_bind)&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx("p",{children:" No Device Data Available"})})]})}),e.jsxs("div",{className:"details-container w-1/3 ",children:[e.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[e.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:P(t.created_at)}),e.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),e.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[e.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:e.jsx(D,{date:t.created_at})}),e.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}const{Panel:ie}=O;function ue(){const{setModalDataList:t,modalDataList:h}=s.useContext(W),{notificationEvent:c}=F(),[m,y]=s.useState("All"),[d,f]=s.useState([]),[i,r]=s.useState(null),[l,o]=s.useState(null),[p,N]=s.useState(null),[u,w]=s.useState(!1),[v,Y]=s.useState(1),[S,a]=s.useState(!0),b=s.useRef(null),C=s.useCallback(()=>{!S||u||(w(!0),$({to_date:"2024-11-30",from_date:M().format("YYYY-MM-DD"),is_resolved:!1,limit:20,show_device_area:1,show_device_boundaries:1,page:v,...p}).then(n=>{f(g=>[...g,...n.data]),v>=n.totalPages&&a(!1),w(!1)}).catch(n=>{console.error(n),w(!1)}))},[p,v,S,u]);s.useEffect(()=>{C()},[v,p]),s.useEffect(()=>{if(d.length>0&&!i){const n=d[0];r(n._id),o(n)}},[d,i]);const _=n=>{r(n);const g=d.find(x=>x._id===n);o(g)},A=s.useCallback(te(()=>{if(!b.current||u||!S)return;const{scrollTop:n,scrollHeight:g,clientHeight:x}=b.current;n+x>=g-50&&Y(T=>T+1)},200),[u,S]),k=n=>{N(H(n)),Y(1),f([]),a(!0)};s.useEffect(()=>{c&&C()},[c]),s.useEffect(()=>{const n=b.current;return n&&n.addEventListener("scroll",A),()=>{n&&n.removeEventListener("scroll",A)}},[A]);const I=s.useMemo(()=>d.reduce((n,g)=>{const x=g.room_name;return n[x]||(n[x]=[]),n[x].push(g),n},{}),[d]),E=n=>{switch(n){case"Critical":return"red";case"Warning":return"orange";case"Info":return"blue";default:return"gray"}};return e.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[e.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[e.jsx(se,{style:{width:"100%"},block:!0,options:oe,onChange:n=>k(n)}),e.jsxs("div",{ref:b,className:"w-full overflow-auto",style:{height:"440px"},children:[d.length===0&&!u&&e.jsx(R,{description:"No active alerts available"}),d.length>0&&e.jsx(O,{children:Object.entries(I).map(([n,g])=>([...new Set(g.map(x=>{var T;return(T=j(x))==null?void 0:T.label}))],e.jsx(ie,{header:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-black font-semibold",children:n})}),children:g&&g.map(x=>{var T;return e.jsxs("div",{onClick:()=>_(x._id),className:`flex justify-between items-center p-2 cursor-pointer rounded-md px-4 ${i===x._id?"bg-gray-100":""}`,children:[e.jsx("span",{className:"text-[14px] font-semibold",children:M(x.created_at).format("hh:mm:ss a")}),e.jsx(le,{color:E((T=j(x))==null?void 0:T.label),size:"large"})]},x._id)})},n)))}),u&&e.jsx("div",{className:"w-full flex justify-center py-4",children:e.jsx(ae,{})}),!S&&d.length>0&&e.jsx("div",{className:"w-full text-center py-4 text-gray-500",children:"No more alerts to load"})]})]}),e.jsx("div",{className:"w-[70%] h-full",children:l?e.jsx(re,{data:l}):e.jsx(R,{description:"Select an alert to view details"})})]})}const oe=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}],L=t=>{const h=["Critical","Info","Warning"],c=["Living Room","Kitchen","Bedroom","Bathroom"],m=["John Doe","Jane Doe","Alice Smith","Bob Johnson","Emma Brown","Michael Wilson","Sarah Davis","David Miller","Lisa Garcia","James Rodriguez"],y=["Fall Detected","Fire Detected","Inactivity Alert","Medication Reminder","Unusual Behavior","High Temperature","Low Temperature","Water Leak","Door Left Open","Window Broken"],d=["Medication Taken","Medication Not Taken","Medication Reminder"],f=["Wheelchair","Crutches","Cane","None"],i=["Yes","No"],r=["Yes","No"],l=["Yes","No"],o=["1","4","2","No"],p=["True","False"];return Array.from({length:t},(N,u)=>({_id:u+1,alertType:h[Math.floor(Math.random()*h.length)],elderlyName:m[Math.floor(Math.random()*m.length)],alertName:y[Math.floor(Math.random()*y.length)],roomId:String(u+1),roomName:c[Math.floor(Math.random()*c.length)],alertLifetime:`${Math.floor(Math.random()*10)}m ${Math.floor(Math.random()*60)}s`,time:new Date().toLocaleString(),alertDescription:`${y[Math.floor(Math.random()*y.length)]} in the ${c[Math.floor(Math.random()*c.length)]}`,status:"Active",isAlert:p[Math.floor(Math.random()*p.length)],address:"123 Main St, Anytown, USA",coordinates:{latitude:37.7749+(Math.random()-.5)*.01,longitude:-122.4194+(Math.random()-.5)*.01},closedAt:new Date().toLocaleString(),closedBy:m[Math.floor(Math.random()*m.length)],eventName:d[Math.floor(Math.random()*d.length)],disabilityType:f[Math.floor(Math.random()*f.length)],additionalInfo:"This is additional info for event",hospital:{name:"Hospital For Special Surgery",phone:"1234567890",latitude:-33.8743612,longitude:151.2261153},allergies:i[Math.floor(Math.random()*i.length)],diseases:r[Math.floor(Math.random()*r.length)],medications:l[Math.floor(Math.random()*l.length)],activeAlert:o[Math.floor(Math.random()*o.length)],alertComments:"This is alert comments",alertLifespan:[{dateTime:"24-01-2024 10:00 AM",description:"At 10:00 AM, the alert was created"},{dateTime:"24-01-2024 10:30 AM",description:"Agent (petar) clicked on the incident in 10:30 (30mins later)"},{dateTime:"24-01-2024 10:32 AM",description:"Agent (petar) clicked on “Call Elderly” in 10:32 (2mins later)"},{dateTime:"24-01-2024 10:34 AM",description:"Agent (petar) clicked on “Call 911” in 10:34 (2mins later)"},{dateTime:"24-01-2024 10:36 AM",description:"Agent (petar) clicked on “Close Alert” in 10:36 (2mins later)"}]}))};L(14);L(20);L(20);L(20);L(20);export{fe as A,ue as R,he as a};
//# sourceMappingURL=mock-DO2QRp9m.js.map
