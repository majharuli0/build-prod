const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DataAnalysis-CkfG9uKv.js","assets/index-Br78m9MR.js","assets/index-Dkg9sF4l.css","assets/MoonFilled-DZ3HBNsz.js","assets/barChart-BRYMIWaC.js","assets/multibarChart-DVnurmei.js","assets/TimelineGraph-CSOefIZH.js","assets/TimelineBar-BXkERhVb.js","assets/LiveRateChart-CaSoHegT.js","assets/SkeletonRateChart-DTyjHzip.js","assets/index-D2Imanik.js","assets/DayRateChart-CdxLOGTF.js","assets/scatterChart-D0t0H2-f.js"])))=>i.map(i=>d[i]);
import{r as S,S as he,br as xe,j as i,i as ue,D as P,h as L,hX as ve,hU as _e,bb as j,h_ as Z,gq as p,ck as R,B as ge,fm as De}from"./index-Br78m9MR.js";import{W as be}from"./WeeklyMonthlyPicker-CBGE3R45.js";try{let r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},h=new r.Error().stack;h&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[h]="ba39381a-152c-472d-86fa-d65384b118c7",r._sentryDebugIdIdentifier="sentry-dbid-ba39381a-152c-472d-86fa-d65384b118c7")}catch{}const Ee=()=>Array.from({length:12},(r,h)=>({date:`2023-10-${String(h*2+1).padStart(2,"0")}`,value:Math.floor(Math.random()*100)+1})),se=()=>Array.from({length:12},(r,h)=>({date:`2023-10-${String(h*2+2).padStart(2,"0")}`,value:Math.floor(Math.random()*100)+1})),Te=()=>Array.from({length:12},(r,h)=>({date:`2023-10-${String(h*2+1).padStart(2,"0")}`,value:Math.floor(Math.random()*180)+1}));Ee();se();Te();function Se(r,h){return typeof r!="function"?(console.error("apiFunction is not a function or is undefined"),Promise.reject(new Error("apiFunction is not a function"))):r(h).then(E=>E).catch(E=>{throw console.error("API Request Error:",E),E})}j.lazy(()=>R(()=>import("./DataAnalysis-CkfG9uKv.js"),__vite__mapDeps([0,1,2,3])));const we=j.lazy(()=>R(()=>import("./barChart-BRYMIWaC.js"),__vite__mapDeps([4,1,2]))),y=j.lazy(()=>R(()=>import("./multibarChart-DVnurmei.js"),__vite__mapDeps([5,1,2]))),je=j.lazy(()=>R(()=>import("./TimelineGraph-CSOefIZH.js"),__vite__mapDeps([6,1,2]))),Re=j.lazy(()=>R(()=>import("./TimelineBar-BXkERhVb.js"),__vite__mapDeps([7,1,2])));j.lazy(()=>R(()=>import("./LiveRateChart-CaSoHegT.js"),__vite__mapDeps([8,1,2])));const Me=j.lazy(()=>R(()=>import("./SkeletonRateChart-DTyjHzip.js").then(r=>r.a),__vite__mapDeps([9,1,2,10]))),Ce=j.lazy(()=>R(()=>import("./DayRateChart-CdxLOGTF.js"),__vite__mapDeps([11,1,2]))),Ae=j.lazy(()=>R(()=>import("./scatterChart-D0t0H2-f.js"),__vite__mapDeps([12,1,2]))),{RangePicker:ke,DatePicker:Fe}=P;function $(r){const[h,E,e]=r.split(":").map(Number);return h*60+E+e/60}function Ie({visible:r,onClose:h,modalData:E,summaryProps:e}){var J;const[x,k]=S.useState(""),[u,I]=S.useState(""),[C,N]=S.useState(null),[D,A]=S.useState([]),[M,Y]=S.useState([]),[H,U]=S.useState([]),{sleepEventsType:O,sleepEventsColor:W}=S.useContext(he),m=S.useContext(xe),{elderlyDetails:z}=m||{};function ee(t){k(t.end),I(t.start),N("weeklyMonthly")}function te(t,a){k(a[1]||""),I(a[0]||""),N("range")}function ne(t,a){k(null),I(a||""),N("day")}function q(t){return t.map(({date:a,events:n})=>{const o=n.reduce((c,{event_type:g})=>(c[g]=(c[g]||0)+1,c),{}),l=Object.entries(o).map(([c,g])=>({name:O[c],value:`${g}`,status:c,color:W[c]}));return{date:a,data:l}})}function ae(t){return Array.isArray(t)?t.map(n=>{var l;const o=((l=n.sleep_index_common_list)==null?void 0:l.reduce((c,g)=>{const w=Number(g==null?void 0:g.value)||0;return c+w},0))||"0";return{date:(n==null?void 0:n.date)||null,bed_exit_duration:o}}):(console.error("Invalid data format: Expected an array."),[])}function le(t){return t.map(n=>{const o=n.sleep_index_common_list.reduce((l,c)=>l+parseInt(c.value,10),0);return{date:n.date,totalFallAsleepDuration:o}})}function ie(t){const a=[];return t==null||t.forEach(n=>{var l;const o=n.date;(l=n==null?void 0:n.events)==null||l.forEach(c=>{if(c.event_type===14||c.event_type===15){const g=a.find(w=>w.date===o);g?g.anomalyHeartRate+=1:a.push({date:o,anomalyHeartRate:1})}})}),a}function oe(t){const a=[];return console.log(t),t==null||t.forEach(n=>{var c,g,w,B,F,V;const l={date:L(n.datestr).subtract(1,"day").format("YYYY-MM-DD"),data:[]};((c=n==null?void 0:n.user_activity)==null?void 0:c.static_duration)!==void 0&&l.data.push({name:"still_time",value:$((g=n==null?void 0:n.user_activity)==null?void 0:g.static_duration),status:"30"}),((w=n==null?void 0:n.user_activity)==null?void 0:w.walk_duration)!==void 0&&l.data.push({name:"walking_duration",value:$((B=n==null?void 0:n.user_activity)==null?void 0:B.walk_duration),status:"31"}),((F=n==null?void 0:n.user_activity)==null?void 0:F.other_duration)!==void 0&&l.data.push({name:"other_duration",value:$((V=n==null?void 0:n.user_activity)==null?void 0:V.other_duration),status:"32"}),a.push(l)}),a}function ce(t){var n,o,l,c,g,w,B,F,V,K,Q;let a=[];if(t||U([]),(e==null?void 0:e.title)==="Breath Rate Summary"||(e==null?void 0:e.title)==="Heart Rate Summary")!x&&((n=t[0])!=null&&n.avg)&&(a=[{name:"Avg. Breath Rate",value:(o=t[0])==null?void 0:o.avg},{name:"Min. Breath Rate",value:(l=t[0])==null?void 0:l.min},{name:"Max. Breath Rate",value:(c=t[0])==null?void 0:c.max}]);else if((e==null?void 0:e.title)==="Sleep Timeline Summary")if((g=t[0])!=null&&g.statistical_data&&u&&x==null){console.log(t[0]);const b=(w=t[0])==null?void 0:w.statistical_data.reduce((v,f)=>{const d=new Date(f.start_time),T=(new Date(f.end_time)-d)/(1e3*60),_=O[f.status];return v[_]||(v[_]={duration:0}),v[_].duration+=T,v},{});a=Object.entries(b).map(([v,{duration:f}])=>{const d=Math.floor(f/60),s=Math.floor(f%60);return{name:v,value:`${d}hr ${s}m`}}),a=[{name:"Fell Asleep",value:p((B=t[0])==null?void 0:B.sleep_st_idx)},...a,{name:"Bed Exit After Sleep",value:((F=t[0])==null?void 0:F.leave_bed_count)+"x"},{name:"Wake Up",value:p((V=t[0])==null?void 0:V.sleep_ed_idx)}]}else{const b={},v=t.map(f=>({data:f.sleep_index_common_list,date:f.date}));v==null||v.forEach(f=>{var d;(d=f==null?void 0:f.data)==null||d.forEach(({name:s,value:T,status:_,ratio:fe})=>{b[_]||(b[_]={name:`Avg. ${O[_]}`,totalValue:0,totalRatio:0,count:0}),b[_].totalValue+=parseInt(T),b[_].totalRatio+=fe,b[_].count+=1})}),a=Object.entries(b).map(([f,d])=>{const s=Math.round(d.totalValue/d.count),T=Math.floor(s/60),_=s%60;return{name:d.name,value:`${T}hr ${_}m`,ratio:Math.round(d.totalRatio/d.count)}})}else if((e==null?void 0:e.title)==="Sleep Events Summary")if((K=t[0])!=null&&K.events&&u&&x==null)a=(Q=t[0])==null?void 0:Q.events.reduce((v,f)=>{const d=O[f.event_type],s=v.find(T=>T.name===d);if(s){const T=parseInt(s.value.replace("x",""));s.value=`${T+1}x`}else v.push({name:d,value:"1x",color:W[d]});return v},[]);else{const b={},v=q(t);v==null||v.forEach(f=>{var d;(d=f==null?void 0:f.data)==null||d.forEach(({name:s,value:T,status:_})=>{b[_]||(b[_]={name:`Avg. ${O[_]}`,totalValue:0,count:0}),b[_].totalValue+=parseInt(T),b[_].count+=1})}),a=Object.entries(b).map(([f,d])=>{const s=Math.round(d.totalValue/d.count);return{name:d.name,value:`${s}x`}})}return U(a),a}function G(t){if(t||A([]),(e==null?void 0:e.title)==="Sleep Timeline Summary")if(u&&x){const a=t.map(n=>({data:n.sleep_index_common_list,date:n.date}));A(a)}else A(t[0]);else if((e==null?void 0:e.title)==="Sleep Events Summary"){const a=q(t);A(a)}else if((e==null?void 0:e.title)==="Breathing Rate Overview Summary"||(e==null?void 0:e.title)==="Heart Rate Overview Summary"){if(x&&u){const a={xdata:t.map(n=>n.date),maxArray:t.map(n=>n.max),minArray:t.map(n=>n.min),allAvgNumber:Math.round(t.reduce((n,o)=>n+o.avg,0)/t.length)};A(a)}}else{if((e==null?void 0:e.title)==="Bed Exit Duration After Sleep Overview Summary")return ae(t);if((e==null?void 0:e.title)==="Sleep Latency Overview Summary")return le(t);if((e==null?void 0:e.title)==="Heart Rate Variation Overview Summary")return ie(t);if((e==null?void 0:e.title)==="Room Occupancy Duration Overview Summary"){const a=oe(t);A(a)}}return t}S.useEffect(()=>{async function t(){var a,n,o;if((a=e==null?void 0:e.apisProps)!=null&&a.endpoint)try{const l=await Se((n=e==null?void 0:e.apisProps)==null?void 0:n.endpoint,{...(o=e==null?void 0:e.apisProps)==null?void 0:o.query,elderly_id:z==null?void 0:z._id,from_date:x,to_date:u});l&&(l!=null&&l.data)&&(Y(G(l==null?void 0:l.data)),ce(l==null?void 0:l.data),G(l==null?void 0:l.data))}catch(l){console.error("Error fetching summary data:",l),Y([])}}t()},[(J=e==null?void 0:e.apisProps)==null?void 0:J.endpoint,x,u]);const de=()=>{var t;return(t=e==null?void 0:e.pickerTypes)==null?void 0:t.map(a=>{switch(a){case"weeklyMonthly":return i.jsx(be,{placeholder:"Weekly/Monthly",style:{width:"140px",borderRadius:"10px"},handleChnage:ee,value:C==="weeklyMonthly"&&u&&x?{start:u,end:x}:null},"weeklyMonthly");case"range":return i.jsx(ke,{showTime:!1,style:{width:"200px",borderRadius:"10px"},size:"large",placeholder:["Pick Data Range (Start)","End"],format:"YYYY-MM-DD",onChange:(n,o)=>te(n,o),value:C==="range"&&x&&u?[L(u),L(x)]:null,allowClear:!0},"range");case"day":return i.jsx(P,{style:{width:"200px",borderRadius:"10px"},size:"large",format:"YYYY-MM-DD",onChange:(n,o)=>ne(n,o),value:C==="day"&&u?L(u):null,allowClear:!0},"day");default:return null}})},X={multibar:{default:{component:y,getProps:()=>({data:D,toDate:x,fromDate:u,valueType:e==null?void 0:e.dataType})},day:{component:je,getProps:()=>({statisticalData:D==null?void 0:D.statistical_data,enterBedTime:p(D==null?void 0:D.get_bed_idx),getupAfterTime:p(D==null?void 0:D.leave_bed_idx)})}},multibar_sleep_events:{default:{component:y,getProps:()=>({data:D,toDate:x,fromDate:u,valueType:e==null?void 0:e.dataType})},day:{component:Re,getProps:()=>{var t,a,n;return{alarmEvents:(t=M[0])==null?void 0:t.events,enterBedTime:Z((a=M[0])==null?void 0:a.get_bed_idx),getupAfterTime:Z((n=M[0])==null?void 0:n.leave_bed_idx)}}}},bar:{default:{component:we,getProps:()=>({data:M,dataType:e==null?void 0:e.dataType,color:e==null?void 0:e.color,xUnit:e==null?void 0:e.xUnit,toDate:e!=null&&e.isFromToDate?x:"",fromDate:e!=null&&e.isFromToDate?u:"",numberLimit:e==null?void 0:e.numberLimit,dataUnit:e==null?void 0:e.dataUnit,chartFor:e==null?void 0:e.chartFor})}},rate:{default:{component:Me,getProps:()=>({cheartInfo:D,color:e==null?void 0:e.color,dateType:"Month",fromDate:u,toDate:x})},day:{component:Ce,getProps:()=>{var t,a;return{data:((t=M[0])==null?void 0:t.data_list)||[],timestamp:((a=M[0])==null?void 0:a.timestamps)||[],color:e==null?void 0:e.color,type:e==null?void 0:e.dataType}}}},scatter:{default:{component:Ae,getProps:()=>({data:(e==null?void 0:e.title)!=="Distribution of bed exit times Summary"?ve(M):_e(M),colors:{gotobed:"#2EC7C9",wakeup:"#5AB1EF",getup:"#FFB980",fallasleep:"#B6A2DE",bedexit:"#508C9B"}})}}},re=()=>{var l,c;const t=e==null?void 0:e.chartType,a=((l=X[t])==null?void 0:l[C])||((c=X[t])==null?void 0:c.default);if(!a)return null;const{component:n,getProps:o}=a;return i.jsx(S.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(n,{...o()})})};return i.jsx(ue,{open:r,onCancel:h,footer:null,width:"100%",style:{height:"100vh",padding:0,borderRadius:0,top:0},className:"!rounded-none summaryModal !h-[100vh] overflow-hidden",children:i.jsxs("div",{className:"p-4 h-[100vh]",children:[i.jsxs("div",{className:"flex flex-col justify-center items-center mb-4 gap-2",children:[i.jsx("h2",{className:"text-2xl font-bold text-primary",children:e==null?void 0:e.title}),i.jsx("div",{id:"DatePickers",className:"flex gap-4 items-center justify-center mt-4",children:de()})]}),H.length>0&&i.jsx("div",{id:"chartTotal",className:"flex w-full flex-wrap items-center justify-center border-b mt-12",children:H.map((t,a,n)=>i.jsx(Ne,{label:t.name,value:t.value,isFirst:a===0,isLast:a===n.length-1},a))}),i.jsx("div",{className:"report-content max-h-[350px]  w-[90%] mt-16 mx-auto",children:re()})]})})}const Ne=({label:r,value:h,isFirst:E,isLast:e})=>i.jsxs("div",{id:"totalItem",className:`max-w-[200px] w-fit border p-1 px-6 flex items-center justify-center border-b-[0.5px] flex-col ${E&&e?"rounded-tl-xl rounded-tr-xl":E?"rounded-tl-xl":e?"rounded-tr-xl":""}`,children:[i.jsx("h1",{className:"text-2xl font-bold text-primary text-nowrap",children:h}),i.jsx("span",{className:"text-sm font-medium opacity-80 text-primary text-nowrap",children:r})]});function Ve({children:r,title:h,color:E,icon:e,dataAnalysis:x,isDataAnalysis:k=!0,isSummaryBtn:u=!0,summaryProps:I,headerClassName:C}){const[N,D]=S.useState(!1);return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex flex-col gap-6 p-6 bg-white rounded-2xl !w-full h-full ",children:[i.jsxs("div",{id:"header",className:"flex justify-between items-center w-full",children:[i.jsx("h1",{className:`text-[21px] font-bold text-primary ${C}`,children:h}),u&&i.jsx(ge,{onClick:()=>D(!0),icon:i.jsx(De,{}),size:"large",children:"Summary"})]}),i.jsx("div",{className:"h-full",children:r}),k&&x!==""&&i.jsxs("div",{id:"footer",className:"flex gap-3 items-center p-2 px-3",children:[i.jsx("div",{id:"icon",style:{color:"white",fontSize:"20px",backgroundColor:E},className:"p-2 rounded-full",children:e}),i.jsx("span",{className:"text-[15px] capitalize",children:x})]})]}),i.jsx(Ie,{visible:N,onClose:()=>D(!1),summaryProps:{...I,color:E,icon:e}})]})}export{Ve as T};
//# sourceMappingURL=Template-Cpvjv_eg.js.map
